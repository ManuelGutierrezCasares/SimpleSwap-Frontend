<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\simpleSwap.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> simpleSwap.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">95.92% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>47/49</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">55% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>22/40</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>7/7</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">96.61% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>57/59</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">44×</span>
<span class="cline-any cline-yes">44×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.27;
&nbsp;
import {ERC20} from "@openzeppelin/contracts/token/ERC20/ERC20.sol";
&nbsp;
/// @title SimpleSwap contract
/// @author Manuel Gutierrez Casares
/// @notice This contract is based on Uniswap v2
/// @dev All function calls are currently implemented without side effects
/// @custom:experimental This is an experimental contract.
&nbsp;
contract SimpleSwap is ERC20 {
    address public _tokenA;
    address public _tokenB;
&nbsp;
    constructor() ERC20("liquidity", "LQD") {}
&nbsp;
    /// @dev Users are able to add liquidity to the management pool.
    /// @dev It's a must to use this function to initialize the management pool.
    function addLiquidity(address tokenA, address tokenB, uint amountADesired, uint amountBDesired) external returns (uint amountA, uint amountB, uint liquidity) {
        address __tokenA = _tokenA;
        address __tokenB = _tokenB;
&nbsp;
        /// Initializing token addresses for  and check for wrong tokens
        <span class="missing-if-branch" title="else path not taken" >E</span>if (__tokenA == address(0) &amp;&amp; __tokenB == address(0)) {
            _tokenA = tokenA;
            _tokenB = tokenB;
        } else {
<span class="cstat-no" title="statement not covered" >            require(__tokenA == tokenA &amp;&amp; __tokenB == tokenB, "Can't swap tokens")</span>;
        }
&nbsp;
        /// Approve so SC will be able to transfer tokens for the user
        ERC20(tokenA).approve(address(this), amountADesired);
        ERC20(tokenB).approve(address(this), amountBDesired);
&nbsp;
        /// Transfer tokens A and B according to what user wants to add to pool
        ERC20(tokenA).transferFrom(msg.sender, address(this), amountADesired);
        ERC20(tokenB).transferFrom(msg.sender, address(this), amountBDesired);
&nbsp;
        /// Calculate liquidity, send liquidity tokens to user and add 
        liquidity = sqrt(amountADesired * amountBDesired);
        _mint(msg.sender, liquidity);
&nbsp;
        return (ERC20(tokenA).balanceOf(address(this)), ERC20(tokenB).balanceOf(address(this)), liquidity);
&nbsp;
    }
&nbsp;
    /// @dev Users are able to withdraw their tokens based on their current liquidity token amount.
    function removeLiquidity(address tokenA, address tokenB, uint liquidity, uint amountAMin, uint amountBMin) external returns (uint amountA, uint amountB) {
        address __tokenA = _tokenA;
        address __tokenB = _tokenB;
        
        /// Validations
        <span class="missing-if-branch" title="else path not taken" >E</span>require(__tokenA != address(0) &amp;&amp; __tokenB != address(0), "Add liquidity first");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(__tokenA == tokenA &amp;&amp; __tokenB == tokenB, "Can't swap tokens");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(balanceOf(msg.sender) &gt;= liquidity, "Not enough liquidity");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(ERC20(tokenA).balanceOf(address(this)) &gt;= amountAMin, "Not enough tokens A");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(ERC20(tokenB).balanceOf(address(this)) &gt;= amountBMin, "Not enough tokens B");
&nbsp;
        uint _totalSupply = totalSupply();
&nbsp;
        /// Burn user's liquidity tokens
        _burn(msg.sender, liquidity);
&nbsp;
        /// Calculate amount of tokens to transfer
        uint withdrawnA = ERC20(tokenA).balanceOf(address(this)) * (liquidity / _totalSupply);
        uint withdrawnB = ERC20(tokenB).balanceOf(address(this)) * (liquidity / _totalSupply);
&nbsp;
        /// Validate min amount of tokens
        <span class="missing-if-branch" title="else path not taken" >E</span>require(withdrawnA &gt;= amountAMin &amp;&amp; withdrawnB &gt;= amountBMin, "Not enough liquidity");
&nbsp;
        /// Transfer tokens according to what user wants to remove from pool
        ERC20(tokenA).transfer(msg.sender, withdrawnA);
        ERC20(tokenB).transfer(msg.sender, withdrawnB);
&nbsp;
        return(withdrawnA, withdrawnB);
&nbsp;
    }
&nbsp;
    /// @dev Swaps one token for another in exact amounts.
    function swapExactTokensForTokens(uint amountIn, uint amountOutMin, address[] calldata path) external returns (uint[] memory amounts) {
        address __tokenA = _tokenA;
        address __tokenB = _tokenB;
        
        /// Validations
        <span class="missing-if-branch" title="else path not taken" >E</span>require((path[0] == __tokenA || path[1] == __tokenA) &amp;&amp; (path[0] == __tokenB || path[1]== __tokenB), "Can't swap these");
        if(path[1] == __tokenB) {
            <span class="missing-if-branch" title="else path not taken" >E</span>require(ERC20(__tokenB).balanceOf(address(this)) &gt;= amountOutMin, "Not enough tokens B");
        } else {
            <span class="missing-if-branch" title="else path not taken" >E</span>require(ERC20(__tokenA).balanceOf(address(this)) &gt;= amountOutMin, "Not enough tokens A");
        }
&nbsp;
        /// Approve and transfer amountIn
        ERC20(path[0]).approve(address(this), amountIn);
        ERC20(path[0]).transferFrom(msg.sender, address(this), amountIn);
&nbsp;
        /// Compute amount Out
        uint withdrawn;
        if(path[0] == __tokenA) {
            withdrawn = (amountIn * ERC20(__tokenB).balanceOf(address(this))) / (ERC20(__tokenA).balanceOf(address(this)) + amountIn);
        } else {
            withdrawn = (amountIn * ERC20(__tokenA).balanceOf(address(this))) / (ERC20(__tokenB).balanceOf(address(this)) + amountIn);
        }
&nbsp;
        /// Check if withdrawn value is valid
        <span class="missing-if-branch" title="else path not taken" >E</span>require(withdrawn &gt;= amountOutMin, "Not enough tokens");
&nbsp;
        /// Transfer amountOut
        ERC20(path[1]).transfer(msg.sender, withdrawn);
&nbsp;
        uint[] memory returnValue = new uint[](2);
        returnValue[0] = amountIn;
        returnValue[1] = withdrawn;
        
        return(returnValue);
        
    }
&nbsp;
    /// @dev Calculates current price of a token given another.
    function getPrice(address tokenA, address tokenB) external view returns (uint price) {
        address __tokenA = _tokenA;
        address __tokenB = _tokenB;
&nbsp;
        /// Validations
        <span class="missing-if-branch" title="else path not taken" >E</span>require(__tokenA != address(0) &amp;&amp; __tokenB != address(0), "Add liquidity first");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(__tokenA == tokenA &amp;&amp; __tokenB == tokenB, "Can't swap these");
&nbsp;
        return (ERC20(__tokenB).balanceOf(address(this)) * 1e18) / ERC20(__tokenA).balanceOf(address(this));
&nbsp;
    }
&nbsp;
    /// @dev Returns the amount of tokens someone could take out of this contract considering parameters.
    function getAmountOut(uint amountIn, uint reserveIn, uint reserveOut) external pure returns (uint amountOut) {
        return (amountIn * reserveOut) / (reserveIn + amountIn);
    }
&nbsp;
    /// @dev Internal function to calculate square root.
    function sqrt(uint y) internal pure returns (uint z) {
        <span class="missing-if-branch" title="else path not taken" >E</span>if (y &gt; 3) {
            z = y;
            uint x = y / 2 + 1;
            while (x &lt; z) {
                z = x;
                x = (y / x + x) / 2;
            }
        } else <span class="cstat-no" title="statement not covered" >if (y != 0) {</span>
            z = 1;
        }
    }
&nbsp;
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Jul 12 2025 17:38:32 GMT-0300 (hora estándar de Argentina)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
